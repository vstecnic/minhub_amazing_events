var WSB;(function(n){const t="pp_",i=100,r=200;class u{constructor(t,i){this._page=t;this._sections=[];this._selectedItemIndex=-1;this._itemClickEventHandler=(t,i)=>{let r=document.getSelection();r.toString()&&r.focusNode==i.target||t.click(n.getCurrentTime(),n.getInputType(i))};this._contextMenuHandler=(t,r,u)=>{r&&(r.pageX||r.pageY)?n.safeExecute(()=>i.showContextMenuOnXY(t,r.pageX,r.pageY,()=>this.focus(!1),n.getInputType(r),u),"contextMenuHandler"):n.safeExecute(()=>i.showContextMenuOnElement(t,u?_ge(u.id):_ge(t.id),()=>this.focus(!1),r?n.getInputType(r):0,u),"contextMenuHandler")};n.Host.bindSearchBoxGotFocus(()=>{this.blur()});n.Host.bindDismissed(()=>this.blur());n.Host.bindKeyDown(t=>{var i;this.hasFocus()&&(t==36||t==35)&&this.selectFirstOrLastItem(t==36);((i=this._selectedItem)===null||i===void 0?void 0:i.id)==n.PreviewMetadataContainerId&&t==13&&_ge(this._selectedItem.id).click()})}init(t){this._previewPaneViewModelParent=t;this._suggestionClickEventHandler=(t,i)=>{let r=n.getCurrentTime(),u=n.getInputType(i);this._previewPaneViewModelParent.onBeforeItemLaunch(r,u,4,null);t.click(r,u);this._previewPaneViewModelParent.onAfterItemLaunch(4)}}finalizeKeystroke(){this.instrumentOnPreviewPaneRendered(!1,!0)}instrumentOnPreviewPaneRendered(n,t){if(this._timestampFirstRender&&this._onPreviewPaneRendered){let i={firstRenderTS:this._timestampFirstRender,layout:this.getLayoutDataForPPRenderedInstrumentation()};this._onPreviewPaneRendered(t,!n,i)}}update(t,i,r,u,f,e,o){this._currentCallValid&&(this._currentCallValid.valid=!1);f&&(o||(this.instrumentOnPreviewPaneRendered(!1,!0),this._timestampFirstRender=null,this._settingsOnlineModules=[],this._settingsOnlineModulesRetrieved=!1),this._onPreviewPaneRendered=f);this._previewPaneId=u;this._previewedSuggestion=t;this._sections=[];this._hasPreviewIconBeenSet=!1;this._haveActionsBeenFetched=!1;this._sectionRetrieved_jumplist=!1;this._sectionRetrieved_settingsFaq=!1;this._sectionRetrieved_settingsRelatedSettings=!1;this._allSectionsRetrieved=()=>this._sectionRetrieved_jumplist&&this._sectionRetrieved_settingsFaq&&this._sectionRetrieved_settingsRelatedSettings;let c=o&&this.hasFocus();const s=t=>{this._previewPaneViewModelParent.onResponseReceived(n.getCurrentTime());t?this.delayedRender():this.render();(this._previewPaneViewModelParent.focusPending||c)&&(this._previewPaneViewModelParent.focusPending=!1,this.focus(!1))};let h={valid:!0};this._currentCallValid=h;t&&this.updateSelection(t,i,()=>h.valid,()=>s(!1),()=>s(!0))}setPreviewIcon(t,i,u,f,e){let o=(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.isTest)&&(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.DisablePreviewGetIcon);if(!o){let r=4;n.config.anticipateGetVerbsAsync?(t.getIcon(r,i=>{this._hasPreviewIconBeenSet=!0,t.previewIcon=i,n.populateImageRatio(t.previewIcon,t.type,()=>{})}),this.getActions(i,f,e,u)):t.getIcon(r,r=>{this._hasPreviewIconBeenSet=!0,t.previewIcon=r,n.populateImageRatio(t.previewIcon,t.type,()=>this.getActions(i,f,e,u))})}!o&&(n.MockUrlParameters===null||n.MockUrlParameters===void 0?void 0:n.MockUrlParameters.isTest)||n.safeSetTimeout(()=>{this._hasPreviewIconBeenSet||(this._hasPreviewIconBeenSet=!0,t.previewIcon=n.ScopeConfig[n.getScope(n.getGroupType(t))].icon,n.populateImageRatio(t.previewIcon,t.type,()=>this.getActions(i,f,e,u)))},r,"setPreviewIcon")}updateSelection(n,t,i,r,u){n.getIcon?this.setPreviewIcon(n,t,i,r,u):(n.icon&&(n.previewIcon={content:n.icon.content,type:n.icon.type,bgColor:n.icon.bgColor,needsAccentColor:!0,ratio:n.icon.ratio,className:n.icon.className}),this.getActions(t,r,u,i))}hasFocus(){return!!this._selectedItem}focus(t){let i=this.getSelectableItems();if(i.length>0){let r=t?0:this._selectedItemIndex!=-1?this._selectedItemIndex:0,u=i[r];this.select(u,!1);n.Host.searchBoxHasFocus()&&n.Host.setFocusInWebView("localPP focus")}else this._previewPaneViewModelParent.focusPending=!0}readyToBlur(){return!0}blur(){this._selectedItem&&(this._selectedItem.selected=!1,this._selectedItem=null,this.render())}clear(){this._selectedItem=null;this._selectedItemIndex=-1;this._previewedSuggestion=null;this._onPreviewPaneRendered=null;this._sections=[];this._settingsOnlineModules=[];this._settingsOnlineModulesRetrieved=!1;sb_ct(this._renderTimer);this._hasPreviewIconBeenSet=!1;this._renderTimer=null;this.render()}getSelectableItems(){return[].concat(...this.getSelectableItemsByGroup())}getSelectableItemsByGroup(){let t=[];document.getElementById(n.PreviewMetadataContainerId)&&t.push([n.PreviewMetadataContainer]);for(let n of this._sections){let i=[];i=i.concat(n.items);let r=n.collapsedItems.length>0;if(r){let t=_ge(n.collapsedItems[0].id).classList;t.contains("collapsedItem")||(i=i.concat(n.collapsedItems))}t.push(i);r&&t.push([n.expander])}for(let n of this._settingsOnlineModules)t.push(n.settingLinks);return t}getSelectedItem(){return this._selectedItem}select(t,i){if(i){SharedLogHelper.LogError("selectPreviewPaneItem",null,new Error("Can't update search box value when selecting preview pane item"));return}if((this._selectedItem!=t||!this._selectedItem.selected)&&(this._selectedItem&&(this._selectedItem.selected=!1),t)){let i=this.getSelectableItems().findIndex(n=>n==t);if(i<0)SharedLogHelper.LogError("LocalPreviewPane.Select",null,new Error("select called on unknown item"));else{t.selected=!0;this._selectedItem=t;this._selectedItemIndex=i;this.render();let r=_ge(t.id);r&&(r.focus(),this._page.scrollToElement(r,n.StaticHtmlElements.qfPreviewScrollArea,n.StaticHtmlElements.qfPreviewScrollArea.offsetHeight))}}}onAfterKeyDown(t,i){return n.isContextMenuKey(t,i.shiftKey)?(this._contextMenuHandler(this._previewedSuggestion,null,this._selectedItem),!0):!1}selectFirstOrLastItem(n){let t=this.getSelectableItems();if(t.length!=0){let i=n?0:t.length-1;this.select(t[i],!1)}}isAnaheimDataSuggestionType(t){return t.type=="ANAH"||t.type=="ANAR"||t.type=="ANAT"||t.type=="ANAF"||t.type=="ANATH"&&n.config.topHitMuse}isAnaheimDataSuggestion(t){let i=n.getGroupType(t);return this.isAnaheimDataSuggestionType(t)&&(i==n.GroupType.SearchSuggestions||i==n.GroupType.AnaheimDataTopHit&&n.config.topHitMuse)}getAnaheimDataPreviewedSuggestion(n){let t;if(this.isAnaheimDataSuggestion(n)){t=Object.assign({},n);let i="https://"+HitHighlightingParser.removeMarkers(t.primaryMetadata),r=new URL(i);t.primaryMetadata=r.hostname}return t}getDataModel(){if(this._previewedSuggestion){let t=this.getAnaheimDataPreviewedSu